#!/bin/bash
# Update these with your AWS details
AWS_REGION="us-west-1"
AWS_ACCOUNT_ID="your-account-id"
ECR_REPOSITORY="aws-ecs-spring-boot"
IMAGE_TAG="latest"

# Full ECR repository URL
ECR_URL="${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com/${ECR_REPOSITORY}"

echo "Building Docker image for AMD64 architecture..."
docker build --platform linux/amd64 -t ${ECR_REPOSITORY}:${IMAGE_TAG} .

echo "Authenticating Docker to ECR..."
aws ecr get-login-password --region ${AWS_REGION} | \
docker login --username AWS --password-stdin ${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com

echo "Tagging image..."
docker tag ${ECR_REPOSITORY}:${IMAGE_TAG} ${ECR_URL}:${IMAGE_TAG}

echo "Pushing image to ECR..."
docker push ${ECR_URL}:${IMAGE_TAG}

echo "Done! Image pushed to: ${ECR_URL}:${IMAGE_TAG}"
